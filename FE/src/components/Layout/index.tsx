import React, { useEffect, useLayoutEffect, useRef, useState } from "react";
import "./style.scss";
import { CategoryType } from "@/store/category/type";
import { useSelector } from "react-redux";
import { userSelector } from "@/store/user/selector";
import Avatar from "@/assets/img/auth/login-background-1.jpg";
import NavigateItem, { NavType } from "./NavigateItem/NavigateItem";
import { useHistory } from "react-router-dom";

interface IPropsLayoutMain {
  children: React.ReactNode;
}

type HeaderMenuItemType = {
  id: number;
  path: string;
  title: string;
  icon: React.ReactElement;
};

const navMenu: NavType[] = [
  {
    id: 1,
    title: "Home",
  },
  {
    id: 2,
    title: "Category",
    menuItem: [
      {
        id: 1,
        name: "Sneaker",
        code: "SNEAKER"
      },
      {
        id: 2,
        name: "Boot",
        code: "BOOT"
      },
      {
        id: 3,
        name: "Sport",
        code: "SPORT"
      },
    ],
  },
  {
    id: 3,
    title: "About",
  },
  {
    id: 4,
    title: "Contact",
  },
];

const headerMenu: HeaderMenuItemType[] = [
  {
    id: 1,
    path: "/user",
    title: "View profile",
    icon: <svg viewBox="-42 0 512 512.001" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="m210.351562 246.632812c33.882813 0 63.21875-12.152343 87.195313-36.128906 23.96875-23.972656 36.125-53.304687 36.125-87.191406 0-33.875-12.152344-63.210938-36.128906-87.191406-23.976563-23.96875-53.3125-36.121094-87.191407-36.121094-33.886718 0-63.21875 12.152344-87.191406 36.125s-36.128906 53.308594-36.128906 87.1875c0 33.886719 12.15625 63.222656 36.128906 87.195312 23.980469 23.96875 53.316406 36.125 87.191406 36.125zm-65.972656-189.292968c18.394532-18.394532 39.972656-27.335938 65.972656-27.335938 25.996094 0 47.578126 8.941406 65.976563 27.335938 18.394531 18.398437 27.339844 39.980468 27.339844 65.972656 0 26-8.945313 47.578125-27.339844 65.976562-18.398437 18.398438-39.980469 27.339844-65.976563 27.339844-25.992187 0-47.570312-8.945312-65.972656-27.339844-18.398437-18.394531-27.34375-39.976562-27.34375-65.976562 0-25.992188 8.945313-47.574219 27.34375-65.972656zm0 0"/><path d="m426.128906 393.703125c-.691406-9.976563-2.089844-20.859375-4.148437-32.351563-2.078125-11.578124-4.753907-22.523437-7.957031-32.527343-3.3125-10.339844-7.808594-20.550781-13.375-30.335938-5.769532-10.15625-12.550782-19-20.160157-26.277343-7.957031-7.613282-17.699219-13.734376-28.964843-18.199219-11.226563-4.441407-23.667969-6.691407-36.976563-6.691407-5.226563 0-10.28125 2.144532-20.042969 8.5-6.007812 3.917969-13.035156 8.449219-20.878906 13.460938-6.707031 4.273438-15.792969 8.277344-27.015625 11.902344-10.949219 3.542968-22.066406 5.339844-33.042969 5.339844-10.96875 0-22.085937-1.796876-33.042968-5.339844-11.210938-3.621094-20.300782-7.625-26.996094-11.898438-7.769532-4.964844-14.800782-9.496094-20.898438-13.46875-9.753906-6.355468-14.808594-8.5-20.035156-8.5-13.3125 0-25.75 2.253906-36.972656 6.699219-11.257813 4.457031-21.003906 10.578125-28.96875 18.199219-7.609375 7.28125-14.390625 16.121094-20.15625 26.273437-5.558594 9.785157-10.058594 19.992188-13.371094 30.339844-3.199219 10.003906-5.875 20.945313-7.953125 32.523437-2.0625 11.476563-3.457031 22.363282-4.148437 32.363282-.679688 9.777344-1.023438 19.953125-1.023438 30.234375 0 26.726562 8.496094 48.363281 25.25 64.320312 16.546875 15.746094 38.4375 23.730469 65.066406 23.730469h246.53125c26.621094 0 48.511719-7.984375 65.0625-23.730469 16.757813-15.945312 25.253906-37.589843 25.253906-64.324219-.003906-10.316406-.351562-20.492187-1.035156-30.242187zm-44.90625 72.828125c-10.933594 10.40625-25.449218 15.464844-44.378906 15.464844h-246.527344c-18.933594 0-33.449218-5.058594-44.378906-15.460938-10.722656-10.207031-15.933594-24.140625-15.933594-42.585937 0-9.59375.316406-19.066407.949219-28.160157.617187-8.921874 1.878906-18.722656 3.75-29.136718 1.847656-10.285156 4.199219-19.9375 6.996094-28.675782 2.683593-8.378906 6.34375-16.675781 10.882812-24.667968 4.332031-7.617188 9.316407-14.152344 14.816407-19.417969 5.144531-4.925781 11.628906-8.957031 19.269531-11.980469 7.066406-2.796875 15.007812-4.328125 23.628906-4.558594 1.050781.558594 2.921875 1.625 5.953125 3.601563 6.167969 4.019531 13.277344 8.605469 21.136719 13.625 8.859375 5.648437 20.273437 10.75 33.910156 15.152344 13.941406 4.507812 28.160156 6.796875 42.273437 6.796875 14.113282 0 28.335938-2.289063 42.269532-6.792969 13.648437-4.410156 25.058594-9.507813 33.929687-15.164063 8.042969-5.140624 14.953125-9.59375 21.121094-13.617187 3.03125-1.972656 4.902344-3.042969 5.953125-3.601563 8.625.230469 16.566406 1.761719 23.636719 4.558594 7.636719 3.023438 14.121093 7.058594 19.265625 11.980469 5.5 5.261719 10.484375 11.796875 14.816406 19.421875 4.542969 7.988281 8.207031 16.289062 10.886719 24.660156 2.800781 8.75 5.15625 18.398438 7 28.675782 1.867187 10.433593 3.132812 20.238281 3.75 29.144531v.007812c.636719 9.058594.957031 18.527344.960937 28.148438-.003906 18.449219-5.214844 32.378906-15.9375 42.582031zm0 0"/></svg>
  },
  {
    id: 2,
    path: "/home",
    title: "Feedback and help",
    icon: <svg viewBox="-21 -37 681.33304 681" width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="m634.070312 67.636719-63.878906-63.875c-6.226562-6.230469-16.332031-6.238281-22.566406-.007813 0 .003906-.003906.007813-.011719.007813l-191.621093 191.628906c-2.996094 2.992187-4.675782 7.050781-4.675782 11.285156v63.878907c0 8.816406 7.148438 15.964843 15.964844 15.964843h63.878906c4.234375 0 8.292969-1.679687 11.285156-4.675781l191.625-191.625c6.234376-6.230469 6.238282-16.335938.011719-22.570312-.003906 0-.003906-.007813-.011719-.011719zm-209.523437 186.949219h-41.296875v-41.292969l175.65625-175.65625 41.292969 41.292969zm0 0"/><path d="m590.839844 190.710938c-8.816406 0-15.964844 7.148437-15.964844 15.964843v223.5625c-.027344 26.445313-21.460938 47.878907-47.90625 47.910157h-159.6875c-3.457031-.007813-6.820312 1.113281-9.582031 3.191406l-102.199219 76.652344v-63.875c0-8.820313-7.148438-15.96875-15.96875-15.96875h-159.6875c-26.445312-.03125-47.878906-21.464844-47.902344-47.90625v-287.441407c.027344-26.441406 21.457032-47.875 47.902344-47.902343h287.4375c8.820312 0 15.96875-7.148438 15.96875-15.96875 0-8.816407-7.148438-15.964844-15.96875-15.964844h-287.4375c-44.078125.042968-79.8007812 35.765625-79.84375 79.835937v287.441407c.0429688 44.074218 35.765625 79.796874 79.84375 79.84375h143.71875v79.84375c0 8.816406 7.148438 15.964843 15.96875 15.964843 3.457031 0 6.816406-1.121093 9.582031-3.191406l123.507813-92.621094h154.347656c44.078125-.042969 79.796875-35.765625 79.84375-79.84375v-223.558593c0-8.820313-7.152344-15.96875-15.972656-15.96875zm0 0"/><path d="m271.464844 158.773438h-159.679688c-8.824218 0-15.972656 7.148437-15.972656 15.96875 0 8.816406 7.148438 15.964843 15.972656 15.964843h159.679688c8.820312 0 15.972656-7.148437 15.972656-15.964843 0-8.820313-7.152344-15.96875-15.972656-15.96875zm0 0"/><path d="m111.785156 286.523438h159.679688c8.820312 0 15.972656-7.152344 15.972656-15.96875 0-8.820313-7.152344-15.96875-15.972656-15.96875h-159.679688c-8.824218 0-15.972656 7.148437-15.972656 15.96875 0 8.816406 7.148438 15.96875 15.972656 15.96875zm0 0"/><path d="m111.785156 382.332031h383.246094c8.820312 0 15.964844-7.148437 15.964844-15.96875 0-8.816406-7.148438-15.964843-15.964844-15.964843h-383.246094c-8.824218 0-15.972656 7.148437-15.972656 15.964843 0 8.820313 7.148438 15.96875 15.972656 15.96875zm0 0"/></svg>
  },
  {
    id: 3,
    path: "/home",
    title: "Settings",
    icon: <svg xmlns="http://www.w3.org/2000/svg" id="Layer_3" data-name="Layer 3" width="20" height="20" viewBox="0 0 32 32"><path d="M28.068,12H27.94a.934.934,0,0,1-.864-.6.924.924,0,0,1,.2-1.01l.091-.091a2.938,2.938,0,0,0,0-4.147l-1.511-1.51a2.935,2.935,0,0,0-4.146,0l-.091.091A.956.956,0,0,1,20,4.061V3.932A2.935,2.935,0,0,0,17.068,1H14.932A2.935,2.935,0,0,0,12,3.932v.129a.956.956,0,0,1-1.614.668L10.3,4.638a2.935,2.935,0,0,0-4.146,0L4.638,6.148a2.938,2.938,0,0,0,0,4.147l.091.091a.935.935,0,0,1,.185,1.035A.924.924,0,0,1,4.06,12H3.932A2.935,2.935,0,0,0,1,14.932v2.136A2.935,2.935,0,0,0,3.932,20H4.06a.934.934,0,0,1,.864.6.924.924,0,0,1-.2,1.01l-.091.091a2.938,2.938,0,0,0,0,4.147l1.51,1.509a2.934,2.934,0,0,0,4.147,0l.091-.091a.936.936,0,0,1,1.035-.185.922.922,0,0,1,.579.853v.129A2.935,2.935,0,0,0,14.932,31h2.136A2.935,2.935,0,0,0,20,28.068v-.129a.956.956,0,0,1,1.614-.668l.091.091a2.935,2.935,0,0,0,4.146,0l1.511-1.509a2.938,2.938,0,0,0,0-4.147l-.091-.091a.935.935,0,0,1-.185-1.035A.924.924,0,0,1,27.94,20h.128A2.935,2.935,0,0,0,31,17.068V14.932A2.935,2.935,0,0,0,28.068,12ZM29,17.068a.933.933,0,0,1-.932.932H27.94a2.956,2.956,0,0,0-2.083,5.028l.09.091a.934.934,0,0,1,0,1.319l-1.511,1.509a.932.932,0,0,1-1.318,0l-.09-.091A2.957,2.957,0,0,0,18,27.939v.129a.933.933,0,0,1-.932.932H14.932A.933.933,0,0,1,14,28.068v-.129a2.951,2.951,0,0,0-5.028-2.082l-.091.091a.934.934,0,0,1-1.318,0l-1.51-1.509a.934.934,0,0,1,0-1.319l.091-.091A2.956,2.956,0,0,0,4.06,18H3.932A.933.933,0,0,1,3,17.068V14.932A.933.933,0,0,1,3.932,14H4.06A2.956,2.956,0,0,0,6.143,8.972l-.09-.091a.933.933,0,0,1,0-1.318L7.563,6.052a.932.932,0,0,1,1.318,0l.09.091A2.957,2.957,0,0,0,14,4.061V3.932A.933.933,0,0,1,14.932,3h2.136A.933.933,0,0,1,18,3.932v.129a2.956,2.956,0,0,0,5.028,2.082l.091-.091a.932.932,0,0,1,1.318,0l1.51,1.511a.933.933,0,0,1,0,1.318l-.091.091A2.956,2.956,0,0,0,27.94,14h.128a.933.933,0,0,1,.932.932Z"/><path d="M16,9a7,7,0,1,0,7,7A7.008,7.008,0,0,0,16,9Zm0,12a5,5,0,1,1,5-5A5.006,5.006,0,0,1,16,21Z"/></svg>
  },
  {
    id: 4,
    path: "/home",
    title: "Logout",
    icon: <svg id="Layer_1" viewBox="0 0 512 512" width="20" height="20" xmlns="http://www.w3.org/2000/svg" data-name="Layer 1"><path d="m363.335 488a24 24 0 0 1 -24 24h-226.253a80.09 80.09 0 0 1 -80-80v-352a80.09 80.09 0 0 1 80-80h226.253a24 24 0 0 1 0 48h-226.253a32.035 32.035 0 0 0 -32 32v352a32.034 32.034 0 0 0 32 32h226.253a24 24 0 0 1 24 24zm108.553-248.97-114.051-114.052a24 24 0 1 0 -33.937 33.941l73.077 73.081h-188.936a24 24 0 1 0 0 48h188.935l-73.08 73.08a24 24 0 1 0 33.941 33.941l114.051-114.05a24 24 0 0 0 0-33.941z"/></svg>
  },
];

export const LayoutMain: React.FC<IPropsLayoutMain> = ({ children }) => {
  const [isMenuDisplay, setIsMenuDisplay] = useState<boolean>(false);
  const [isLoading, setIsLoading] = useState<boolean>(false);
  const [searchContent, setSearchContent] = useState<string>("");
  const [isTextContain, setIsTextContain] = useState<boolean>(false);
  const [hidden, setHidden] = useState(false);

  const history = useHistory();

  const user = useSelector(userSelector);

  const userImageRef = useRef<HTMLImageElement>(null);
  const menuRef = useRef<HTMLDivElement>(null);

  const handleHiddenMenu = (event: MouseEvent) => {
    if (
      !userImageRef.current?.contains(event.target as Node) &&
      !menuRef.current?.contains(event.target as Node) 
    ) {
      setIsMenuDisplay(false);
    }
  };

  useEffect(() => {
    const handleScroll = () => {
      if (window.scrollY > 100) {
        setHidden(true);
      } else {
        setHidden(false);
      }
    };

    window.addEventListener('scroll', handleScroll);

    return () => {
      window.removeEventListener('scroll', handleScroll);
    };
})

  useEffect(() => {
    if(searchContent === "") {
      setIsTextContain(false);
    } else {
      setIsTextContain(true);
    }
  }, [searchContent])

  useLayoutEffect(() => {
    document.addEventListener('mousedown', handleHiddenMenu);

    return () => {
      document.removeEventListener('mousedown', handleHiddenMenu);
    };
  });


  return (
    <div id="project-wrapper">
      <header className={`${hidden ? 'header-hidden' : 'header-display'}`}>
        <div id="header-back"></div>
        <span className="logo" onClick={() => history.push("/")}>
        <svg id="Capa_1" enable-background="new 0 0 512 512" height="80" viewBox="0 0 512 512" width="80" xmlns="http://www.w3.org/2000/svg"><linearGradient id="SVGID_1_" gradientUnits="userSpaceOnUse" x1="256" x2="256" y1="512" y2="0"><stop offset="0" stop-color="#ffbef9"/><stop offset="1" stop-color="#fff1ff"/></linearGradient><linearGradient id="SVGID_2_" gradientUnits="userSpaceOnUse" x1="256" x2="256" y1="336" y2="176"><stop offset="0" stop-color="#ff81ff"/><stop offset="1" stop-color="#a93aff"/></linearGradient><circle cx="256" cy="256" fill="url(#SVGID_1_)" r="256"/><path d="m359.379 241.48-9.741-1.389c-15.518-2.217-30.692-6.291-45.323-11.789l-28.807 34.592c-3.133 3.753-8.718 4.286-12.517 1.137-3.765-3.142-4.276-8.75-1.136-12.526l25.357-30.448c-5.47-2.602-10.832-5.413-16.068-8.459l-26.082 31.321c-3.133 3.753-8.718 4.286-12.517 1.137-3.764-3.142-4.276-8.75-1.136-12.526l24.616-29.561c-10.421-7.262-20.271-15.352-29.274-24.361-2.533-2.552-6.358-3.307-9.68-1.927-3.322 1.372-5.482 4.618-5.482 8.212 0 14.705-11.953 26.666-26.647 26.666h-28.174c-13.627 0-26.968-5.529-36.605-15.173-2.542-2.535-6.35-3.316-9.681-1.927-3.322 1.372-5.482 4.618-5.482 8.212v79.998h300.03c-5.521-21.197-23.205-37.974-45.651-41.189zm-254.379 58.965v8.889c0 14.704 11.953 26.666 26.647 26.666h266.471c4.91 0 8.882-3.976 8.882-8.889v-26.666z" fill="url(#SVGID_2_)"/></svg>
        </span>
        <nav>
          {navMenu.map((item) => (
            <NavigateItem key={item.id} item={item}/>
          ))}
        </nav>
        <div id="header-right">
          <div id="search-bar">
            <input id="search-input" type="text" value={searchContent} onChange={e => setSearchContent(e.target.value.trim())}/>
            {isLoading && <svg id="Capa_1" enable-background="new 0 0 497 497" height="20" viewBox="0 0 497 497" width="20" xmlns="http://www.w3.org/2000/svg"><g><circle cx="98" cy="376" fill="#909ba6" r="53"/><circle cx="439" cy="336" fill="#c8d2dc" r="46"/><circle cx="397" cy="112" fill="#e9edf1" r="38"/><ellipse cx="56.245" cy="244.754" fill="#7e8b96" rx="56.245" ry="54.874"/><ellipse cx="217.821" cy="447.175" fill="#a2abb8" rx="51.132" ry="49.825"/><ellipse cx="349.229" cy="427.873" fill="#b9c3cd" rx="48.575" ry="47.297"/><ellipse cx="117.092" cy="114.794" fill="#5f6c75" rx="58.801" ry="57.397"/><ellipse cx="453.538" cy="216.477" fill="#dce6eb" rx="43.462" ry="42.656"/><circle cx="263" cy="62" fill="#4e5a61" r="62"/></g></svg>}
            {isTextContain && <svg height="20" viewBox="0 0 32 32" onClick={() => setSearchContent("")} width="20" xmlns="http://www.w3.org/2000/svg"><g id="Layer_22" data-name="Layer 22"><path d="m25.9 6.1a14 14 0 1 0 0 19.8 14 14 0 0 0 0-19.8zm-4.9 13.44a1 1 0 0 1 0 1.46 1 1 0 0 1 -.71.29 1 1 0 0 1 -.7-.29l-3.59-3.59-3.54 3.59a1 1 0 0 1 -.7.29 1 1 0 0 1 -.71-.29 1 1 0 0 1 0-1.41l3.54-3.59-3.54-3.54a1 1 0 0 1 1.41-1.41l3.54 3.54 3.54-3.54a1 1 0 0 1 1.46 1.41l-3.59 3.54z"/></g></svg>}
          </div>
          <span id="shopping-bag">
          <svg height="32" viewBox="0 0 512 512" fill="white" width="32" xmlns="http://www.w3.org/2000/svg"><g id="Layer_1" data-name="Layer 1"><path d="m437.127 492.035a21.82 21.82 0 0 1 -16.076 6.965h-330.102a22.035 22.035 0 0 1 -21.989-23.459l1.757-27.141h370.566l1.757 27.141a21.821 21.821 0 0 1 -5.913 16.494zm-15.685-350.15a22.084 22.084 0 0 0 -21.989-20.612h-38.167v18.9a22.787 22.787 0 1 1 -30 0v-18.9h-150.286v18.9a22.787 22.787 0 1 1 -30 0v-18.9h-38.453a22.084 22.084 0 0 0 -21.989 20.613l-19.194 296.514h369.272zm-255.585 28.508a13.036 13.036 0 0 0 5.143-25.014v-36.093c0-59.286 44.136-86.286 85.144-86.286s85.142 27 85.142 86.286v35.876a13.034 13.034 0 1 0 10 .355v-36.231c0-29.658-10.313-54.618-29.825-72.181-17.268-15.544-40.461-24.105-65.317-24.105s-48.05 8.561-65.318 24.1c-19.512 17.568-29.826 42.528-29.826 72.186v35.98a13.032 13.032 0 0 0 4.856 25.127z"/></g></svg>
          </span>
          {user !== undefined ? (
            <div id="header-user">
              <img id="header-user-image" src={Avatar} alt="" ref={userImageRef} onClick={() => setIsMenuDisplay(!isMenuDisplay)}/>
              {
                isMenuDisplay && <div id="header-user-menu" ref={menuRef}>
                {headerMenu.map((item) => (
                  <div className="menu-item" onClick={() => history.push(item.path)}>
                    {item.icon}
                    <p className="title">{item.title}</p>
                  </div>
                ))}
              </div>
              }
            </div>
          ) : (
            <div id="header-user-sign" onClick={() => history.push("/sign-in")}>Sign in</div>
          )}
        </div>
      </header>
      <main>{children}</main>
    </div>
  );
};
